package main

import (
	"fmt"
	"os/exec"
	"testing"
)

func loginToContainer(containerName string) ([]byte, error) {
	loginCommand := "docker exec " + containerName + " /bin/bash"
	return exec.Command("sh", "-c", loginCommand).CombinedOutput()
}

func enterVTYSH(loginOutput []byte) ([]byte, error) {
	vtyshCommand := "vtysh"
	return exec.Command("sh", "-c", string(loginOutput)+" -c '"+vtyshCommand+"'").CombinedOutput()
}

func configureOSPF(vtyshOutput []byte) ([]byte, error) {
	commands := "router ospf; network 192.168.0.0 area 0; exit;"
	return exec.Command("sh", "-c", string(vtyshOutput)+" -c '"+commands+"'").CombinedOutput()
}

func showOSPFNeighbors(vtyshOutput []byte) ([]byte, error) {
	showCommand := "do show ip ospf neighbor"
	return exec.Command("sh", "-c", string(vtyshOutput)+" -c '"+showCommand+"'").CombinedOutput()
}

func exitOSPFConfig(vtyshOutput []byte) ([]byte, error) {
	exitCommand := "no router ospf"
	return exec.Command("sh", "-c", string(vtyshOutput)+" -c '"+exitCommand+"'").CombinedOutput()
}

func TestConnectToRouter16(t *testing.T) {
	containerName := "clab-frrlab-router2"

	// Login to container
	loginOutput, err := loginToContainer(containerName)
	if err != nil {
		fmt.Println("Error logging in to the container:", err)
		return
	}

	// Enter VTYSH
	vtyshOutput, err := enterVTYSH(loginOutput)
	if err != nil {
		fmt.Println("Error entering VTYSH:", err)
		return
	}

	// Configure OSPF
	configOutput, err := configureOSPF(vtyshOutput)
	if err != nil {
		fmt.Println("Error configuring OSPF:", err)
		return
	}

	// Show OSPF neighbors
	neighborOutput, err := showOSPFNeighbors(vtyshOutput)
	if err != nil {
		fmt.Println("Error showing OSPF neighbors:", err)
		return
	}

	// Exit OSPF configuration
	exitOutput, err := exitOSPFConfig(vtyshOutput)
	if err != nil {
		fmt.Println("Error exiting OSPF configuration:", err)
		return
	}

	// Print the outputs (can be modified to handle differently)
	fmt.Println("Login output:")
	fmt.Println(string(loginOutput))
	fmt.Println("VTYSH output:")
	fmt.Println(string(vtyshOutput))
	fmt.Println("Configuration output:")
	fmt.Println(string(configOutput))
	fmt.Println("Neighbor output:")
	fmt.Println(string(neighborOutput))
	fmt.Println("Exit output:")
	fmt.Println(string(exitOutput))
}
